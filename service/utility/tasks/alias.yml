---
- name: alias | find all files
  find:
    paths: roles
    recurse: yes
    patterns: 'alias.sh'
  register: find_result

- name: alias | create temporary directory
  include_tasks: '{{ helper_tempfile }}'
  vars:
    tempfile_suffix: '.alias'

- name: alias | copy file to tmp directory
  copy:
    src: '{{ item.path }}'
    dest: '{{ helper_tempfile_result.path }}/{{ item.path.split("/")[1] }}'
  loop: '{{ find_result.files | sort(attribute="path") }}'

- name: alias | create main file
  assemble:
    src: '{{ helper_tempfile_result.path }}'
    dest: '{{ user_home }}/{{ utility_aliases_dest }}'
    delimiter: "\n"

- name: add source line
  lineinfile:
    path: '{{ user_home }}/.zshrc'
    line: 'source "$HOME/{{ utility_aliases_dest }}"'

- name: add the shebang to the first line
  lineinfile:
    insertbefore: BOF
    path: '{{ user_home }}/{{ utility_aliases_dest }}'
    line: "#!/bin/bash\n"
