---
- name: copy | collect stat
  include_tasks: '{{ helper_stat }}'
  vars:
    path: '{{ item.dir | default(None) }}'
    object: '{{ utility_copy_list }}'

- name: copy | remove existing directory
  include_tasks: '{{ helper_dir_remove }}'
  vars:
    path: '{{ item.stat.path }}'
    object: '{{ helper_stat_result.results }}'

- name: copy | with privilege
  become: yes
  copy:
    backup: yes
    src: '{{ item.1.src }}'
    dest: '{{ item.1.dest }}'
  when: item.0.privilege is defined
  loop: |-
    {{ q(
      'subelements',
      utility_copy_list,
      'paths')
    }}

- name: copy | without privilege
  copy:
    backup: yes
    src: '{{ item.1.src }}'
    dest: '{{ item.1.dest }}'
  when: item.0.privilege is not defined
  loop: |-
    {{ q(
      'subelements',
      utility_copy_list,
      'paths')
    }}
