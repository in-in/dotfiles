---
- name: copy | collect stat
  stat:
    path: '{{ item.dir }}'
  register: stat_result
  when: item.dir is defined
  loop: '{{ utility_copy_list }}'

- name: copy | remove existing directory
  file:
    path: '{{ item.stat.path }}'
    state: absent
  when:
    - item is not skipped
    - item.stat.exists
    - item.stat.isdir is defined
  loop: '{{ stat_result.results }}'

- name: copy | with privilege
  become: yes
  copy:
    backup: yes
    src: '{{ item.1.src }}'
    dest: '{{ item.1.dest }}'
  when: item.0.privilege is defined
  loop: |-
    {{ q(
      'subelements',
      utility_copy_list,
      'paths')
    }}

- name: copy | without privilege
  copy:
    backup: yes
    src: '{{ item.1.src }}'
    dest: '{{ item.1.dest }}'
  when: item.0.privilege is not defined
  loop: |-
    {{ q(
      'subelements',
      utility_copy_list,
      'paths')
    }}
