---
- name: create task variable
  set_fact:
    mime_path: '{{ user_config }}/mimeapps.list'
    entries: |
      {% for item in data.type %}
        {{- item }}={{ data.entry_name }}.desktop
      {% endfor %}

- name: create file and section header
  copy:
    content: |
      [Default Applications]

      [Added Associations]
    dest: '{{ mime_path }}'
  when: mime_path is not file

- name: add block to 'default' section
  blockinfile:
    marker: '# {mark} role: {{ role_name }} for Default section'
    path: '{{ mime_path }}'
    insertafter: '\[Default Applications\]'
    block: '{{ entries }}'

- name: add block to 'added' section
  blockinfile:
    marker: '# {mark} role: {{ role_name }} for Added section'
    path: '{{ mime_path }}'
    insertafter: '\[Added Associations\]'
    block: '{{ entries }}'
