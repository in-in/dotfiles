- name: helper | mime | create task variables
  set_fact:
    mime_path: '{{ user_config }}/mimeapps.list'
    entries: |
      {% for item in mime_facts.type %}
        {{- item }}={{ mime_facts.entry_name }}.desktop
      {% endfor %}

- name: helper | mime | create file and section header
  copy:
    content: |
      [Default Applications]

      [Added Associations]
    dest: '{{ mime_path }}'
  when: mime_path is not file

- name: helper | mime | add text block to 'default' section
  blockinfile:
    marker: '# {mark} role: {{ role_name | upper }} for Default section'
    path: '{{ mime_path }}'
    insertafter: '\[Default Applications\]'
    block: '{{ entries }}'

- name: helper | mime | add text block to 'added' section
  blockinfile:
    marker: '# {mark} role: {{ role_name | upper }} for Added section'
    path: '{{ mime_path }}'
    insertafter: '\[Added Associations\]'
    block: '{{ entries }}'
