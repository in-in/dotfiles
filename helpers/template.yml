- name: helper | template | create directory
  become: "{{ item.privilege | default(false) }}"
  file:
    path: "{{ item.dest }}"
    state: directory
  when: item.dest is not directory
  loop: "{{ template_facts }}"

- name: helper | template | create template
  become: "{{ item.privilege | default(false) }}"
  template:
    src: "{{ item.src }}"
    dest: |-
      {{ item.dest ~ '/' ~
        (item.filename is defined)
        | ternary(item.filename, item.src | basename)
      }}
    backup: "{{ item.backup | default(false) }}"
    lstrip_blocks: True
  vars:
    data: "{{ item.data | default(None) }}"
  loop: "{{ template_facts }}"
