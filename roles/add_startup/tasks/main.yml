---
- name: create startup list
  set_fact:
    add_startup_list: '{{
      hostvars.localhost
      | json_query("*.add_startup")
      | list
    }}'

- name: check if the directory exists
  stat:
    path: '{{ startup.dest }}'
  register: result

- name: recreate the directory
  block:
    - file:
        path: '{{ startup.dest }}'
        state: absent

    - file:
        path: '{{ startup.dest }}'
        state: directory
  when: result.stat.isdir is defined

- name: create the new directory
  file:
    path: '{{ startup.dest }}'
    state: directory
  when: result.stat.isdir is not defined

- name: create templates
  template:
    src: 'entry.desktop.j2'
    dest: '{{ startup.dest }}/{{ item.name }}.desktop'
  with_items: '{{ add_startup_list }}'
