- import_tasks: '{{ helpers }}/template.yml'
  vars:
    template_facts:
      - src: 'viewer.py'
        dest: '{{ user_config }}/calibre'
  tags:
    - 'user_font'
    - 'template_calibre'

- import_tasks: '{{ helpers }}/tempfile.yml'

- name: get the installer
  get_url:
    url: '{{ calibre_installer }}'
    dest: '{{ helper_tempfile_result }}'
  register: get_url_result
  until: get_url_result.msg is match('OK*')
  retries: 10
  delay: 10

- name: install
  become: True
  script: '{{ helper_tempfile_result }}/{{ calibre_installer | basename }}'

- import_tasks: '{{ helpers }}/mime.yml'
  vars:
    mime_facts:
      entry_name: 'calibre-ebook-viewer'
      type:
        - 'application/epub+zip'
  tags: 'mime'
