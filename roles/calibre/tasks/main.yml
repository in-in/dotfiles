---
# TODO: I only need 'ebook-viewer', but I have to download the whole Calibre

- name: run template helper
  import_tasks: '{{ helper_path }}/template.yml'
  vars:
    template_list:
      - src: 'viewer.py'
        dest: '{{ user_config }}/calibre'

- name: create temporary directory
  import_tasks: '{{ helper_path }}/tempfile.yml'
  vars:
    tempfile_suffix: '.calibre'

- name: get the installer
  get_url:
    url: '{{ calibre_installer }}'
    dest: '{{ helper_tempfile_result.path }}'
  register: get_url_result
  until: get_url_result.msg is match('OK*')
  retries: 10
  delay: 10

- name: install
  become: yes
  script: '{{ helper_tempfile_result.path }}/{{ calibre_installer | basename }}'

- name: add entries to mime list
  import_tasks: '{{ helper_path }}/mime.yml'
  vars:
    data: '{{ mime_list }}'
