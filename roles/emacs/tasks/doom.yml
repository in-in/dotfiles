- import_tasks: '{{ helpers }}/package_apt_add.yml'
  vars:
    package_apt_add_facts:
      - 'ripgrep'
      - 'fd-find'

- name: 'clone doom repo'
  git:
    repo: 'https://github.com/hlissner/doom-emacs'
    dest: '{{ emacs_cfg_dir }}'
    depth: 1

- name: 'create task variable'
  set_fact:
    config_files: |
      {{
        config_files
        | default([])
        + [
            {} | combine({
              'src': 'doom/' ~ item.path,
              'dest': doom_dir
              })
          ]
      }}
  loop: '{{ lookup("filetree", role_path ~ "/templates/doom") }}'
  tags: 'template_doom'

- import_tasks: '{{ helpers }}/template.yml'
  vars:
    template_facts: '{{ config_files }}'
  tags: 'template_doom'

- name: 'install doom itself'
  expect:
    command: '{{ emacs_cfg_dir }}/bin/doom install'
    echo: True
    timeout: null
    responses:
      'Generate an envvar file?': 'y'
      "Download and install all-the-icon's fonts?": 'y'
