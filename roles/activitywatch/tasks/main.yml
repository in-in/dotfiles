- import_tasks: '{{ helpers }}/latest_release.yml'
  vars:
    latest_release_facts:
      owner: 'ActivityWatch'
      repo: 'activitywatch'
      pattern: 'linux-x86_64'
  tags: 'activitywatch_update'

- import_tasks: '{{ helpers }}/dir_create.yml'
  vars:
    dir_create_facts:
      - path:
          - '{{ activitywatch_dir }}'
  tags: 'activitywatch_update'

- name: 'download and unarchive files'
  unarchive:
    src: '{{ item.url }}'
    dest: '{{ activitywatch_dir }}'
    remote_src: True
  register: 'unarchive_result'
  until: 'not unarchive_result.failed'
  retries: 10
  delay: 10
  when: 'item.id == role_name'
  loop: '{{ helper_latest_release_result }}'
  tags: 'activitywatch_update'

- import_tasks: '{{ helpers }}/launcher.yml'
  vars:
    launcher_facts:
      - exec: '{{ activitywatch_dir }}/activitywatch/aw-qt'
        name: 'ActivityWatch'
        delay: 0
        icon: '{{ activitywatch_dir }}/activitywatch/aw-server/aw_server/static/static/logo.png'
        startup: True
