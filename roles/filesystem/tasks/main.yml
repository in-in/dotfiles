- name: mount media storage
  become: yes
  mount:
    backup: yes
    path: '{{ user_storage }}'
    src: '{{ item }}'
    fstype: 'ext4'
    passno: 2
    opts: 'defaults'
    state: 'mounted'
  when: item is exists
  loop: '{{ filesystem_device_list }}'

- name: set the correct permissions
  become: yes
  file:
    recurse: yes
    path: '{{ user_storage }}'
    owner: '{{ ansible_user_id }}'
    group: '{{ ansible_user_id }}'

- import_tasks: '{{ helpers }}/dir_create.yml'
  vars:
    dir_create_facts:
      - '{{ user_storage }}/download'
      - '{{ user_storage }}/game'
      - '{{ user_storage }}/laptop'
      - '{{ user_storage }}/podcast'
      - '{{ user_storage }}/vms'

- name: remove directory
  file:
    path: '{{ user_storage }}/lost+found'
    state: absent
