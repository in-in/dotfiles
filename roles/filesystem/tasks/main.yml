---
- name: collect stat
  include_tasks: '{{ helper_stat }}'
  vars:
    path: '{{ item }}'
    object: '{{ filesystem_device_list }}'

- name: mount media storage
  become: yes
  mount:
    backup: yes
    path: '{{ user_storage }}'
    src: '{{ item.stat.path }}'
    fstype: 'ext4'
    passno: 2
    opts: 'defaults'
    state: 'mounted'
  when: item.stat.exists
  loop: '{{ helper_stat_result.results }}'

- name: set the correct permissions
  become: yes
  file:
    recurse: yes
    path: '{{ user_storage }}'
    owner: '{{ ansible_user_id }}'
    group: '{{ ansible_user_id }}'

- name: create directory
  include_tasks: '{{ helper_dir_create }}'
  vars:
    path: '{{ user_storage }}/{{ item }}'
  loop: '{{ filesystem_directory_list }}'

- name: clean the room
  include_tasks: '{{ helper_dir_remove }}'
  vars:
    path: '{{ user_storage }}/lost+found'
