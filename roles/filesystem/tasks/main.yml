- name: mount media storage
  become: True
  mount:
    backup: True
    path: "{{ user_storage }}"
    src: "{{ lookup('first_found', filesystem_device_list) }}"
    fstype: "ext4"
    passno: "2"
    opts: "defaults"
    state: "mounted"

- name: set the correct permissions
  become: True
  file:
    recurse: True
    path: "{{ user_storage }}"
    owner: "{{ ansible_user_id }}"
    group: "{{ ansible_user_id }}"

- import_tasks: "{{ helpers }}/dir_create.yml"
  vars:
    dir_create_facts:
      - "{{ user_storage }}/download"
      - "{{ user_storage }}/game"
      - "{{ user_storage }}/laptop"
      - "{{ user_storage }}/podcast"
      - "{{ user_storage }}/vms/shared"
  tags: "filesystem_dir_create"

- name: remove directory
  file:
    path: "{{ user_storage }}/lost+found"
    state: absent

- block:
    - name: increase the limit of inodes
      sysctl:
        name: fs.inotify.max_user_watches
        value: "524288"
        state: present

    - name: decrease the swappiness parameter
      sysctl:
        name: vm.swappiness
        value: "20"
        state: present
  become: True
