---
- name: run stat helper
  import_tasks: '{{ helpers }}/stat.yml'
  vars:
    path: '{{ item }}'
    data: '{{ filesystem_device_list }}'

- name: mount media storage
  become: yes
  mount:
    backup: yes
    path: '{{ user_storage }}'
    src: '{{ item.stat.path }}'
    fstype: 'ext4'
    passno: 2
    opts: 'defaults'
    state: 'mounted'
  when: item.stat.exists
  loop: '{{ helper_stat_result.results }}'

- name: set the correct permissions
  become: yes
  file:
    recurse: yes
    path: '{{ user_storage }}'
    owner: '{{ ansible_user_id }}'
    group: '{{ ansible_user_id }}'

- name: run dir_create helper
  import_tasks: '{{ helpers }}/dir_create.yml'
  vars:
    dir_create_data:
      - '{{ user_storage }}/download'
      - '{{ user_storage }}/game'
      - '{{ user_storage }}/laptop'
      - '{{ user_storage }}/podcast'
      - '{{ user_storage }}/vms'

- name: remove directory
  file:
    path: '{{ user_storage }}/lost+found'
    state: absent
