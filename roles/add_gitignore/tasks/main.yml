---
- name: create temporary directory
  file:
    path: '{{ tmp }}'
    state: directory
    force: yes

- name: create gitignore list
  set_fact:
    add_gitignore_list: '{{
      hostvars.localhost
      | json_query("*.add_gitignore")
      | list
    }}'

- name: create template files
  template:
    src: ignore.j2
    dest: '{{ tmp }}/{{ item.0 }}'
  with_indexed_items: '{{ add_gitignore_list }}'

- name: assemble all files
  assemble:
    src: '{{ tmp }}'
    dest: '{{ dotfiles_directory }}/.gitignore'
    delimiter: '\n'
