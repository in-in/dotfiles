---
- name: link | collect stat
  stat:
    path: '{{ item.dest }}'
  register: stat_result
  loop: '{{ q("flattened", utility_link_list) }}'

- name: link | remove existing directory
  file:
    path: '{{ item.item.dest }}'
    state: absent
  when:
    - item.stat.exists
    - item.stat.isdir
  loop: '{{ stat_result.results }}'

- name: link | create link
  file:
    src: '{{ item.src }}'
    dest: '{{ item.dest }}'
    force: yes
    state: link
  loop: '{{ q("flattened", utility_link_list) }}'
