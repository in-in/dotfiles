---
- name: run package helper
  import_tasks: '{{ helper_path }}/package_apt.yml'

- name: run package helper
  import_tasks: '{{ helper_path }}/package_pip.yml'

- name: add entries to mime list
  import_tasks: '{{ helper_path }}/mime.yml'
  vars:
    data: '{{ mime_list }}'

- name: add alias
  import_tasks: '{{ helper_path }}/alias.yml'

- name: reinstall extensions
  block:
    - name: uninstall extensions
      command: 'code --uninstall-extension {{ item }}'
      register: uninstall_result
      changed_when: uninstall_result.stdout | regex_search("(was successfully uninstalled)")
      loop: '{{ vscode_extensions }}'
  rescue:
    - name: extensions failed
      debug:
        msg: '{{ uninstall_result.results | to_nice_json }}'
  always:
    - name: install extensions
      command: 'code --install-extension {{ item }}'
      register: install_result
      changed_when: not install_result.stdout | regex_search("(is already installed)")
      until: install_result.failed == false
      retries: 10
      delay: 10
      loop: '{{ vscode_extensions }}'
