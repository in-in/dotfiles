---
- name: create temporary directory
  file:
    path: '{{ gnome_terminal.tmp }}'
    state: directory
    force: yes

- name: create new theme
  template:
    src: 'terminal.sh.j2'
    dest: '{{ gnome_terminal.tmp }}/{{ item.name | replace(" ", "_") }}.sh'
  with_items: '{{ gnome_terminal_themes }}'

- name: get UUID from file
  shell: "grep 'UUID=' '{{ gnome_terminal.tmp }}/{{ item.path }}' | sed 's/UUID=//'"
  register: uuid_list
  with_filetree: '{{ gnome_terminal.tmp }}'

- name: configure terminal
  script: '{{ gnome_terminal.tmp }}/{{ item.path }}'
  with_filetree: '{{ gnome_terminal.tmp }}'

- name: set all new profiles list
  shell: 'gsettings set org.gnome.Terminal.ProfilesList list "[''{{ uuid_list.results | map(attribute="stdout") | join("'', ''") }}'']"'

- name: set default theme
  shell:
    'gsettings set org.gnome.Terminal.ProfilesList default {{ item.stdout }}'
  when: gnome_terminal_default_theme == item.item.path | replace(".sh", "") | replace("_", " ")
  with_items: '{{ uuid_list.results }}'
