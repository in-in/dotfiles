---
- name: create temporary directory
  file:
    path: '{{ gnome_terminal.tmp }}'
    state: directory
    force: yes


- name: create new theme
  template:
    src: 'terminal.sh.j2'
    dest: '{{ gnome_terminal.tmp }}/{{ item.name }}.sh'
  with_items: '{{ gnome_terminal.themes }}'


- name: get UUID from file
  shell: "grep 'UUID=' '{{ gnome_terminal.tmp }}/{{ item.path }}' | sed 's/UUID=//'"
  register: uuid_list
  with_filetree: '{{ gnome_terminal.tmp }}'


- name: create list of UUID
  set_fact:
    gnome_terminal_profiles: "{{ gnome_terminal_profiles }}, '{{ item.stdout }}'"
  with_items: '{{ uuid_list.results }}'


- name: configure terminal
  script: '{{ gnome_terminal.tmp }}/{{ item.path }}'
  with_filetree: '{{ gnome_terminal.tmp }}'


- name: set all new profiles list
  shell: 'gsettings set org.gnome.Terminal.ProfilesList list "[{{ gnome_terminal_profiles | replace(", ", "", 1)}}]"'
