---
- name: create temporary directory
  import_tasks: '{{ helpers }}/tempfile.yml'
  vars:
    tempfile_suffix: '.gnome_terminal'

- name: create uuid list
  set_fact:
    gnome_terminal_uuid_list: |-
      {{
        gnome_terminal_uuid_list
        | default([])
        + [ item.name | to_uuid ]
      }}
  loop: '{{ gnome_terminal_themes }}'

- name: create zip list
  set_fact:
    zip_gnome_terminal: |-
      {{
        gnome_terminal_themes
        | zip(gnome_terminal_uuid_list)
        | list
      }}

- name: create template
  copy:
    content: "{{ lookup('template', dotfiles_roles ~ '/gnome_terminal/templates/terminal.sh') }}"
    dest: '{{ helper_tempfile_result.path }}/{{ item.0.name | replace(" ", "_") }}.sh'
  loop: '{{ zip_gnome_terminal }}'

- name: configure terminal
  script: '{{ helper_tempfile_result.path }}/{{ item.path }}'
  loop: '{{ q("filetree", helper_tempfile_result.path) }}'

- name: set all new profiles list
  dconf:
    key: '/org/gnome/terminal/legacy/profiles:/list'
    value: '{{ gnome_terminal_uuid_list }}'
    state: present

- name: set default theme
  dconf:
    key: '/org/gnome/terminal/legacy/profiles:/default'
    value: "'{{ item.1 }}'"
    state: present
  when: gnome_terminal_default_theme == item.0.name
  loop: '{{ zip_gnome_terminal }}'
