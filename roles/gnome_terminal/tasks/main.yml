---
- name: create temporary directory
  include_tasks: '{{ helpers_tempfile }}'
  vars:
    tempfile_suffix: '.gnome_terminal'

- name: create uuid list
  set_fact:
    gnome_terminal_uuid_list: '{{ gnome_terminal_uuid_list + [ item.name | to_uuid ] }}'
  loop: '{{ gnome_terminal_themes }}'

- name: create template
  template:
    src: 'terminal.sh.j2'
    dest: '{{ tempfile_result.path }}/{{ item.0.name | replace(" ", "_") }}.sh'
  loop: |-
    {{ q(
      'together',
      gnome_terminal_themes,
      gnome_terminal_uuid_list)
    }}

- name: configure terminal
  script: '{{ tempfile_result.path }}/{{ item.path }}'
  loop: '{{ q("filetree", tempfile_result.path) }}'

- name: set all new profiles list
  dconf:
    key: '/org/gnome/terminal/legacy/profiles:/list'
    value: '{{ gnome_terminal_uuid_list }}'
    state: present

- name: set default theme
  dconf:
    key: '/org/gnome/terminal/legacy/profiles:/default'
    value: "'{{ item.1 }}'"
    state: present
  when: gnome_terminal_default_theme == item.0.name
  loop: |-
    {{ q(
      'together',
      gnome_terminal_themes,
      gnome_terminal_uuid_list)
    }}
