---
- name: ethernet | create task variables
  set_fact:
    wired_name: 'wired_{{ ansible_hostname | to_uuid() | truncate(4, True, "") }}'

- name: ethernet | delete wired connection
  command: nmcli connection delete {{ wired_name }}
  when: wired_name in item
  loop: '{{ nmcli_connection_result.stdout_lines }}'

- name: ethernet | add wired connection
  command: |
    nmcli connection add
    type ethernet
    ifname {{ item.split(":")[0] }}
    con-name {{ wired_name }}
    ethernet.cloned-mac-address random
    connection.autoconnect-priority 10
    ipv4.dns '1.1.1.1 1.0.0.1'
    ipv4.ignore-auto-dns yes
    ipv6.dns '2606:4700:4700::1111 2606:4700:4700::1001'
    ipv6.ignore-auto-dns yes
    ipv6.ip6-privacy 1
  when: '"ethernet" in item'
  loop: '{{ nmcli_device_result.stdout_lines }}'
