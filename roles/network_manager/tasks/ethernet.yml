---
- name: ethernet | get device status
  command: nmcli -t device status
  register: nmcli_device_result
  changed_when: false

- block:
    - name: ethernet | delete wired connection
      command: >
        nmcli connection delete wired_{{ item.split(":")[0] }}
      when: '"ethernet" in item'
      loop: '{{ nmcli_device_result.stdout_lines }}'
  rescue:
    - name: ethernet | unable to find connection
      debug:
        msg: 'unable to find connection'

- name: ethernet | add wired connection
  command: >
    nmcli connection add
    type ethernet
    ifname {{ item.split(":")[0] }}
    con-name wired_{{ item.split(":")[0] }}
    ethernet.cloned-mac-address random
    connection.autoconnect-priority 10
    ipv4.dns '1.1.1.1 1.0.0.1'
    ipv4.ignore-auto-dns yes
    ipv6.dns '2606:4700:4700::1111 2606:4700:4700::1001'
    ipv6.ignore-auto-dns yes
    ipv6.ip6-privacy 1
  when: '"ethernet" in item'
  loop: '{{ nmcli_device_result.stdout_lines }}'
