---
- name: create list
  set_fact:
    add_link_list: '{{
      hostvars.localhost
      | json_query("*.add_link")
      | list
    }}'

- name: check existing directory
  stat:
    path: '{{ item.dest }}'
  register: dir
  with_items: '{{ add_link_list }}'

- name: delete existing directory
  file:
    path: '{{ item.item.dest }}'
    force: yes
    state: absent
  when: item.stat.exists and item.stat.isdir
  with_items: '{{ dir.results }}'

- name: link directory
  file:
    src: '{{ item.src }}'
    dest: '{{ item.dest }}'
    force: yes
    state: link
  with_items: '{{ add_link_list }}'
