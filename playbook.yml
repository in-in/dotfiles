- hosts: local

  vars_files:
    - vars.yml

  pre_tasks:
    - name: create roles list
      blockinfile:
        marker: '    # {mark} Do not edit this list manually'
        insertafter: 'roles:'
        path: '{{ playbook_dir }}/playbook.yml'
        block: |
          {% for role in q('lines', 'ls ' ~ dotfiles_roles) %}
              - {{ role }}
          {% endfor %}

  roles:
    # BEGIN Do not edit this list manually
    - albert
    - ansible_lint
    - audacity
    - autojump
    - bin
    - bluetooth
    - calibre
    - chromium
    - cinnamon
    - cmus
    - common
    - copyq
    - desktop_templates
    - doublecmd
    - easytag
    - emacs
    - filesystem
    - firefox
    - flameshot
    - font
    - git
    - gnome
    - gnome_terminal
    - gpg
    - htop
    - hunspell
    - keepassxc
    - libreoffice
    - liferea
    - megasync
    - mintupdate
    - mpv
    - nemo
    - network_manager
    - nvm
    - oh_my_zsh
    - optimization
    - peco
    - pre_commit
    - redshift
    - rsnapshot
    - simplescreenrecorder
    - sublime
    - synaptic
    - thefuck
    - thunderbird
    - timezone
    - tor_browser
    - transmission
    - virtualbox
    - vscode
    - wireguard
    - youtube_dl
    - zsh
    - zsh_syntax_highlighting
    # END Do not edit this list manually

  post_tasks:
    - name: clean and reboot
      become: True
      block:
        - name: remove useless packages
          apt:
            force_apt_get: True
            autoremove: True
            autoclean: True

        - name: reboot system
          shell: sleep 3 && reboot
          async: 1
          poll: 0
